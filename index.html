<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>School Management System</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .header h1 {
        color: #2c3e50;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        color: #7f8c8d;
        font-size: 1.1em;
      }

      .nav-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
        justify-content: center;
      }

      .nav-tab {
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        color: #2c3e50;
      }

      .nav-tab:hover {
        background: rgba(255, 255, 255, 1);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .nav-tab.active {
        background: #3498db;
        color: white;
      }

      .content-section {
        display: none;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .content-section.active {
        display: block;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #2c3e50;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #3498db;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn-primary {
        background: #3498db;
        color: white;
      }

      .btn-primary:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .btn-success {
        background: #27ae60;
        color: white;
      }

      .btn-success:hover {
        background: #229954;
      }

      .btn-danger {
        background: #e74c3c;
        color: white;
      }

      .btn-danger:hover {
        background: #c0392b;
      }

      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .data-table th,
      .data-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ecf0f1;
      }

      .data-table th {
        background: #34495e;
        color: white;
        font-weight: 600;
      }

      .data-table tr:hover {
        background: #f8f9fa;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .stat-card h3 {
        font-size: 2em;
        margin-bottom: 10px;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: black;
      }

      .search-bar {
        margin-bottom: 20px;
      }

      .search-bar input {
        width: 100%;
        padding: 12px;
        border: 2px solid #ecf0f1;
        border-radius: 25px;
        font-size: 16px;
      }

      @media (max-width: 768px) {
        .nav-tabs {
          flex-direction: column;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üè´School Management System</h1>
        <p>Comprehensive Administration & Management Platform</p>
      </div>

      <div class="nav-tabs">
        <button class="nav-tab active" onclick="showSection('dashboard')">
          üìä Dashboard
        </button>
        <button class="nav-tab" onclick="showSection('students')">
          üë®‚Äçüéì Students
        </button>
        <button class="nav-tab" onclick="showSection('teachers')">
          üë®‚Äçüè´ Teachers
        </button>
        <button class="nav-tab" onclick="showSection('classes')">
          üìö Classes
        </button>
        <button class="nav-tab" onclick="showSection('grades')">
          üìù Grades
        </button>
        <button class="nav-tab" onclick="showSection('fees')">üí∞ Fees</button>
        <button class="nav-tab" onclick="showSection('reports')">
          üìà Reports
        </button>
      </div>

      <!-- Dashboard Section -->
      <div id="dashboard" class="content-section active">
        <h2>School Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="totalStudents">0</h3>
            <p>Total Students</p>
          </div>
          <div class="stat-card">
            <h3 id="totalTeachers">0</h3>
            <p>Total Teachers</p>
          </div>
          <div class="stat-card">
            <h3 id="totalClasses">0</h3>
            <p>Total Classes</p>
          </div>
          <div class="stat-card">
            <h3 id="totalFees">R0</h3>
            <p>Total Fees Collected</p>
          </div>
        </div>

        <h3>Recent Activities</h3>
        <div id="recentActivities">
          <p>
            Welcome to the SA School Management System! Start by adding
            students, teachers, and classes.
          </p>
        </div>
      </div>

      <!-- Students Section -->
      <div id="students" class="content-section">
        <h2>Student Management</h2>
        <button class="btn btn-primary" onclick="openModal('studentModal')">
          ‚ûï Add New Student
        </button>

        <div class="search-bar">
          <input
            type="text"
            id="studentSearch"
            placeholder="üîç Search students..."
            onkeyup="searchStudents()"
          />
        </div>

        <table class="data-table" id="studentsTable">
          <thead>
            <tr>
              <th>Student ID</th>
              <th>Name</th>
              <th>Grade</th>
              <th>ID Number</th>
              <th>Contact</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="studentsTableBody"></tbody>
        </table>
      </div>

      <!-- Teachers Section -->
      <div id="teachers" class="content-section">
        <h2>Teacher Management</h2>
        <button class="btn btn-primary" onclick="openModal('teacherModal')">
          ‚ûï Add New Teacher
        </button>

        <div class="search-bar">
          <input
            type="text"
            id="teacherSearch"
            placeholder="üîç Search teachers..."
            onkeyup="searchTeachers()"
          />
        </div>

        <table class="data-table" id="teachersTable">
          <thead>
            <tr>
              <th>Employee ID</th>
              <th>Name</th>
              <th>Subject</th>
              <th>Qualification</th>
              <th>Contact</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="teachersTableBody"></tbody>
        </table>
      </div>

      <!-- Classes Section -->
      <div id="classes" class="content-section">
        <h2>Class Management</h2>
        <button class="btn btn-primary" onclick="openModal('classModal')">
          ‚ûï Add New Class
        </button>

        <table class="data-table" id="classesTable">
          <thead>
            <tr>
              <th>Class Code</th>
              <th>Grade</th>
              <th>Subject</th>
              <th>Teacher</th>
              <th>Students</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="classesTableBody"></tbody>
        </table>
      </div>

      <!-- Grades Section -->
      <div id="grades" class="content-section">
        <h2>Grade Management</h2>
        <button class="btn btn-primary" onclick="openModal('gradeModal')">
          ‚ûï Add Grade
        </button>

        <div class="form-grid">
          <div>
            <label>Select Student:</label>
            <select id="gradeStudentFilter" onchange="filterGrades()">
              <option value="">All Students</option>
            </select>
          </div>
          <div>
            <label>Select Subject:</label>
            <select id="gradeSubjectFilter" onchange="filterGrades()">
              <option value="">All Subjects</option>
            </select>
          </div>
        </div>

        <table class="data-table" id="gradesTable">
          <thead>
            <tr>
              <th>Student</th>
              <th>Subject</th>
              <th>Assessment</th>
              <th>Mark</th>
              <th>Percentage</th>
              <th>Grade</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="gradesTableBody"></tbody>
        </table>
      </div>

      <!-- Fees Section -->
      <div id="fees" class="content-section">
        <h2>Fee Management</h2>
        <button class="btn btn-primary" onclick="openModal('feeModal')">
          üí∞ Record Payment
        </button>

        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="totalFeesCollected">R0</h3>
            <p>Total Collected</p>
          </div>
          <div class="stat-card">
            <h3 id="totalFeesOutstanding">R0</h3>
            <p>Outstanding</p>
          </div>
        </div>

        <table class="data-table" id="feesTable">
          <thead>
            <tr>
              <th>Student</th>
              <th>Amount Due</th>
              <th>Amount Paid</th>
              <th>Outstanding</th>
              <th>Status</th>
              <th>Last Payment</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="feesTableBody"></tbody>
        </table>
      </div>

      <!-- Reports Section -->
      <div id="reports" class="content-section">
        <h2>Reports & Analytics</h2>

        <div class="form-grid">
          <button class="btn btn-success" onclick="generateReport('academic')">
            üìä Academic Report
          </button>
          <button class="btn btn-success" onclick="generateReport('financial')">
            üí∞ Financial Report
          </button>
          <button
            class="btn btn-success"
            onclick="generateReport('attendance')"
          >
            üìÖ Attendance Report
          </button>
          <button class="btn btn-success" onclick="exportData()">
            üì• Export All Data
          </button>
        </div>

        <div id="reportContent">
          <h3>Select a report type above to view analytics</h3>
        </div>
      </div>
    </div>

    <!-- Student Modal -->
    <div id="studentModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('studentModal')">&times;</span>
        <h2>Student Information</h2>
        <form id="studentForm">
          <div class="form-grid">
            <div class="form-group">
              <label>Student ID:</label>
              <input type="text" id="studentId" required />
            </div>
            <div class="form-group">
              <label>Full Name:</label>
              <input type="text" id="studentName" required />
            </div>
            <div class="form-group">
              <label>ID Number:</label>
              <input
                type="text"
                id="studentIdNumber"
                pattern="[0-9]{13}"
                title="13-digit SA ID number"
              />
            </div>
            <div class="form-group">
              <label>Grade:</label>
              <select id="studentGrade" required>
                <option value="">Select Grade</option>
                <option value="Grade R">Grade R</option>
                <option value="Grade 1">Grade 1</option>
                <option value="Grade 2">Grade 2</option>
                <option value="Grade 3">Grade 3</option>
                <option value="Grade 4">Grade 4</option>
                <option value="Grade 5">Grade 5</option>
                <option value="Grade 6">Grade 6</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
                <option value="Grade 9">Grade 9</option>
                <option value="Grade 10">Grade 10</option>
                <option value="Grade 11">Grade 11</option>
                <option value="Grade 12">Grade 12</option>
              </select>
            </div>
            <div class="form-group">
              <label>Date of Birth:</label>
              <input type="date" id="studentDob" />
            </div>
            <div class="form-group">
              <label>Gender:</label>
              <select id="studentGender">
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
            <div class="form-group">
              <label>Home Language:</label>
              <select id="studentLanguage">
                <option value="">Select Language</option>
                <option value="Afrikaans">Afrikaans</option>
                <option value="English">English</option>
                <option value="isiNdebele">isiNdebele</option>
                <option value="isiXhosa">isiXhosa</option>
                <option value="isiZulu">isiZulu</option>
                <option value="Sepedi">Sepedi</option>
                <option value="Sesotho">Sesotho</option>
                <option value="Setswana">Setswana</option>
                <option value="siSwati">siSwati</option>
                <option value="Tshivenda">Tshivenda</option>
                <option value="Xitsonga">Xitsonga</option>
              </select>
            </div>
            <div class="form-group">
              <label>Contact Number:</label>
              <input type="tel" id="studentContact" />
            </div>
            <div class="form-group">
              <label>Parent/Guardian Name:</label>
              <input type="text" id="studentParent" />
            </div>
            <div class="form-group">
              <label>Parent Contact:</label>
              <input type="tel" id="parentContact" />
            </div>
            <div class="form-group">
              <label>Address:</label>
              <textarea id="studentAddress" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label>Emergency Contact:</label>
              <input type="tel" id="emergencyContact" />
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Save Student</button>
          <button
            type="button"
            class="btn btn-danger"
            onclick="closeModal('studentModal')"
          >
            Cancel
          </button>
        </form>
      </div>
    </div>

    <!-- Teacher Modal -->
    <div id="teacherModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('teacherModal')">&times;</span>
        <h2>Teacher Information</h2>
        <form id="teacherForm">
          <div class="form-grid">
            <div class="form-group">
              <label>Employee ID:</label>
              <input type="text" id="teacherId" required />
            </div>
            <div class="form-group">
              <label>Full Name:</label>
              <input type="text" id="teacherName" required />
            </div>
            <div class="form-group">
              <label>ID Number:</label>
              <input type="text" id="teacherIdNumber" pattern="[0-9]{13}" />
            </div>
            <div class="form-group">
              <label>Subject Specialization:</label>
              <input type="text" id="teacherSubject" required />
            </div>
            <div class="form-group">
              <label>Qualification:</label>
              <input type="text" id="teacherQualification" />
            </div>
            <div class="form-group">
              <label>Contact Number:</label>
              <input type="tel" id="teacherContact" />
            </div>
            <div class="form-group">
              <label>Email:</label>
              <input type="email" id="teacherEmail" />
            </div>
            <div class="form-group">
              <label>Date of Appointment:</label>
              <input type="date" id="teacherStartDate" />
            </div>
            <div class="form-group">
              <label>Salary:</label>
              <input type="number" id="teacherSalary" min="0" step="0.01" />
            </div>
            <div class="form-group">
              <label>Address:</label>
              <textarea id="teacherAddress" rows="3"></textarea>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Save Teacher</button>
          <button
            type="button"
            class="btn btn-danger"
            onclick="closeModal('teacherModal')"
          >
            Cancel
          </button>
        </form>
      </div>
    </div>

    <!-- Class Modal -->
    <div id="classModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('classModal')">&times;</span>
        <h2>Class Information</h2>
        <form id="classForm">
          <div class="form-grid">
            <div class="form-group">
              <label>Class Code:</label>
              <input type="text" id="classCode" required />
            </div>
            <div class="form-group">
              <label>Grade:</label>
              <select id="classGrade" required>
                <option value="">Select Grade</option>
                <option value="Grade R">Grade R</option>
                <option value="Grade 1">Grade 1</option>
                <option value="Grade 2">Grade 2</option>
                <option value="Grade 3">Grade 3</option>
                <option value="Grade 4">Grade 4</option>
                <option value="Grade 5">Grade 5</option>
                <option value="Grade 6">Grade 6</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
                <option value="Grade 9">Grade 9</option>
                <option value="Grade 10">Grade 10</option>
                <option value="Grade 11">Grade 11</option>
                <option value="Grade 12">Grade 12</option>
              </select>
            </div>
            <div class="form-group">
              <label>Subject:</label>
              <input type="text" id="classSubject" required />
            </div>
            <div class="form-group">
              <label>Teacher:</label>
              <select id="classTeacher" required>
                <option value="">Select Teacher</option>
              </select>
            </div>
            <div class="form-group">
              <label>Room Number:</label>
              <input type="text" id="classRoom" />
            </div>
            <div class="form-group">
              <label>Schedule:</label>
              <input
                type="text"
                id="classSchedule"
                placeholder="e.g., Mon-Fri 08:00-09:00"
              />
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Save Class</button>
          <button
            type="button"
            class="btn btn-danger"
            onclick="closeModal('classModal')"
          >
            Cancel
          </button>
        </form>
      </div>
    </div>

    <!-- Grade Modal -->
    <div id="gradeModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('gradeModal')">&times;</span>
        <h2>Add Grade</h2>
        <form id="gradeForm">
          <div class="form-grid">
            <div class="form-group">
              <label>Student:</label>
              <select id="gradeStudent" required>
                <option value="">Select Student</option>
              </select>
            </div>
            <div class="form-group">
              <label>Subject:</label>
              <input type="text" id="gradeSubject" required />
            </div>
            <div class="form-group">
              <label>Assessment Type:</label>
              <select id="assessmentType" required>
                <option value="">Select Type</option>
                <option value="Test">Test</option>
                <option value="Assignment">Assignment</option>
                <option value="Exam">Exam</option>
                <option value="Project">Project</option>
                <option value="Oral">Oral</option>
              </select>
            </div>
            <div class="form-group">
              <label>Mark Obtained:</label>
              <input type="number" id="gradeMark" min="0" required />
            </div>
            <div class="form-group">
              <label>Total Marks:</label>
              <input type="number" id="gradeTotal" min="1" required />
            </div>
            <div class="form-group">
              <label>Date:</label>
              <input type="date" id="gradeDate" required />
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Save Grade</button>
          <button
            type="button"
            class="btn btn-danger"
            onclick="closeModal('gradeModal')"
          >
            Cancel
          </button>
        </form>
      </div>
    </div>

    <!-- Fee Modal -->
    <div id="feeModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('feeModal')">&times;</span>
        <h2>Record Fee Payment</h2>
        <form id="feeForm">
          <div class="form-grid">
            <div class="form-group">
              <label>Student:</label>
              <select id="feeStudent" required>
                <option value="">Select Student</option>
              </select>
            </div>
            <div class="form-group">
              <label>Payment Amount (R):</label>
              <input
                type="number"
                id="feeAmount"
                min="0"
                step="0.01"
                required
              />
            </div>
            <div class="form-group">
              <label>Payment Method:</label>
              <select id="feeMethod" required>
                <option value="">Select Method</option>
                <option value="Cash">Cash</option>
                <option value="EFT">EFT</option>
                <option value="Card">Card</option>
                <option value="Cheque">Cheque</option>
              </select>
            </div>
            <div class="form-group">
              <label>Payment Date:</label>
              <input type="date" id="feeDate" required />
            </div>
            <div class="form-group">
              <label>Reference Number:</label>
              <input type="text" id="feeReference" />
            </div>
            <div class="form-group">
              <label>Notes:</label>
              <textarea id="feeNotes" rows="3"></textarea>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Record Payment</button>
          <button
            type="button"
            class="btn btn-danger"
            onclick="closeModal('feeModal')"
          >
            Cancel
          </button>
        </form>
      </div>
    </div>

    <script>
      // Data storage
      let students = [];
      let teachers = [];
      let classes = [];
      let grades = [];
      let fees = [];

      // Initialize data from localStorage if available
      function loadData() {
        const savedStudents = localStorage.getItem("saSchoolStudents");
        const savedTeachers = localStorage.getItem("saSchoolTeachers");
        const savedClasses = localStorage.getItem("saSchoolClasses");
        const savedGrades = localStorage.getItem("saSchoolGrades");
        const savedFees = localStorage.getItem("saSchoolFees");

        if (savedStudents) students = JSON.parse(savedStudents);
        if (savedTeachers) teachers = JSON.parse(savedTeachers);
        if (savedClasses) classes = JSON.parse(savedClasses);
        if (savedGrades) grades = JSON.parse(savedGrades);
        if (savedFees) fees = JSON.parse(savedFees);

        updateDashboard();
        renderStudents();
        renderTeachers();
        renderClasses();
        renderGrades();
        renderFees();
        populateDropdowns();
      }

      // Save data to localStorage
      function saveData() {
        localStorage.setItem("saSchoolStudents", JSON.stringify(students));
        localStorage.setItem("saSchoolTeachers", JSON.stringify(teachers));
        localStorage.setItem("saSchoolClasses", JSON.stringify(classes));
        localStorage.setItem("saSchoolGrades", JSON.stringify(grades));
        localStorage.setItem("saSchoolFees", JSON.stringify(fees));
      }

      // Navigation
      function showSection(sectionId) {
        // Hide all sections
        const sections = document.querySelectorAll(".content-section");
        sections.forEach((section) => section.classList.remove("active"));

        // Remove active class from all tabs
        const tabs = document.querySelectorAll(".nav-tab");
        tabs.forEach((tab) => tab.classList.remove("active"));

        // Show selected section
        document.getElementById(sectionId).classList.add("active");

        // Add active class to clicked tab
        event.target.classList.add("active");
      }

      // Modal functions
      function openModal(modalId) {
        document.getElementById(modalId).style.display = "block";
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
        // Reset forms
        const form = document.getElementById(modalId).querySelector("form");
        if (form) form.reset();
      }

      // Student management
      document
        .getElementById("studentForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const student = {
            id: document.getElementById("studentId").value,
            name: document.getElementById("studentName").value,
            idNumber: document.getElementById("studentIdNumber").value,
            grade: document.getElementById("studentGrade").value,
            dob: document.getElementById("studentDob").value,
            gender: document.getElementById("studentGender").value,
            language: document.getElementById("studentLanguage").value,
            contact: document.getElementById("studentContact").value,
            parent: document.getElementById("studentParent").value,
            parentContact: document.getElementById("parentContact").value,
            address: document.getElementById("studentAddress").value,
            emergencyContact: document.getElementById("emergencyContact").value,
            dateAdded: new Date().toISOString().split("T")[0],
          };

          students.push(student);
          saveData();
          renderStudents();
          updateDashboard();
          populateDropdowns();
          closeModal("studentModal");
          addActivity(`New student added: ${student.name}`);
        });

      function renderStudents() {
        const tbody = document.getElementById("studentsTableBody");
        tbody.innerHTML = "";

        students.forEach((student, index) => {
          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.name}</td>
                    <td>${student.grade}</td>
                    <td>${student.idNumber}</td>
                    <td>${student.contact}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editStudent(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteStudent(${index})">Delete</button>
                    </td>
                `;
        });
      }

      function searchStudents() {
        const search = document
          .getElementById("studentSearch")
          .value.toLowerCase();
        const rows = document.querySelectorAll("#studentsTableBody tr");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(search) ? "" : "none";
        });
      }

      function deleteStudent(index) {
        if (confirm("Are you sure you want to delete this student?")) {
          students.splice(index, 1);
          saveData();
          renderStudents();
          updateDashboard();
          populateDropdowns();
        }
      }

      // Teacher management
      document
        .getElementById("teacherForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const teacher = {
            id: document.getElementById("teacherId").value,
            name: document.getElementById("teacherName").value,
            idNumber: document.getElementById("teacherIdNumber").value,
            subject: document.getElementById("teacherSubject").value,
            qualification: document.getElementById("teacherQualification")
              .value,
            contact: document.getElementById("teacherContact").value,
            email: document.getElementById("teacherEmail").value,
            startDate: document.getElementById("teacherStartDate").value,
            salary: document.getElementById("teacherSalary").value,
            address: document.getElementById("teacherAddress").value,
            dateAdded: new Date().toISOString().split("T")[0],
          };

          teachers.push(teacher);
          saveData();
          renderTeachers();
          updateDashboard();
          populateDropdowns();
          closeModal("teacherModal");
          addActivity(`New teacher added: ${teacher.name}`);
        });

      function renderTeachers() {
        const tbody = document.getElementById("teachersTableBody");
        tbody.innerHTML = "";

        teachers.forEach((teacher, index) => {
          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${teacher.id}</td>
                    <td>${teacher.name}</td>
                    <td>${teacher.subject}</td>
                    <td>${teacher.qualification}</td>
                    <td>${teacher.contact}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editTeacher(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteTeacher(${index})">Delete</button>
                    </td>
                `;
        });
      }

      function searchTeachers() {
        const search = document
          .getElementById("teacherSearch")
          .value.toLowerCase();
        const rows = document.querySelectorAll("#teachersTableBody tr");

        rows.forEach((row) => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(search) ? "" : "none";
        });
      }

      function deleteTeacher(index) {
        if (confirm("Are you sure you want to delete this teacher?")) {
          teachers.splice(index, 1);
          saveData();
          renderTeachers();
          updateDashboard();
          populateDropdowns();
        }
      }

      // Class management
      document
        .getElementById("classForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const classData = {
            code: document.getElementById("classCode").value,
            grade: document.getElementById("classGrade").value,
            subject: document.getElementById("classSubject").value,
            teacher: document.getElementById("classTeacher").value,
            room: document.getElementById("classRoom").value,
            schedule: document.getElementById("classSchedule").value,
            students: [],
            dateAdded: new Date().toISOString().split("T")[0],
          };

          classes.push(classData);
          saveData();
          renderClasses();
          updateDashboard();
          closeModal("classModal");
          addActivity(`New class created: ${classData.code}`);
        });

      function renderClasses() {
        const tbody = document.getElementById("classesTableBody");
        tbody.innerHTML = "";

        classes.forEach((classData, index) => {
          const teacherName =
            teachers.find((t) => t.id === classData.teacher)?.name ||
            "Unassigned";
          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${classData.code}</td>
                    <td>${classData.grade}</td>
                    <td>${classData.subject}</td>
                    <td>${teacherName}</td>
                    <td>${classData.students.length}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editClass(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteClass(${index})">Delete</button>
                    </td>
                `;
        });
      }

      function deleteClass(index) {
        if (confirm("Are you sure you want to delete this class?")) {
          classes.splice(index, 1);
          saveData();
          renderClasses();
          updateDashboard();
        }
      }

      // Grade management
      document
        .getElementById("gradeForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const mark = parseInt(document.getElementById("gradeMark").value);
          const total = parseInt(document.getElementById("gradeTotal").value);
          const percentage = ((mark / total) * 100).toFixed(1);

          let grade = "";
          if (percentage >= 80) grade = "A";
          else if (percentage >= 70) grade = "B";
          else if (percentage >= 60) grade = "C";
          else if (percentage >= 50) grade = "D";
          else if (percentage >= 40) grade = "E";
          else grade = "F";

          const gradeData = {
            student: document.getElementById("gradeStudent").value,
            subject: document.getElementById("gradeSubject").value,
            assessment: document.getElementById("assessmentType").value,
            mark: mark,
            total: total,
            percentage: percentage,
            grade: grade,
            date: document.getElementById("gradeDate").value,
            dateAdded: new Date().toISOString().split("T")[0],
          };

          grades.push(gradeData);
          saveData();
          renderGrades();
          closeModal("gradeModal");
          addActivity(
            `Grade added for ${
              students.find((s) => s.id === gradeData.student)?.name
            }`
          );
        });

      function renderGrades() {
        const tbody = document.getElementById("gradesTableBody");
        tbody.innerHTML = "";

        grades.forEach((gradeData, index) => {
          const studentName =
            students.find((s) => s.id === gradeData.student)?.name || "Unknown";
          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${studentName}</td>
                    <td>${gradeData.subject}</td>
                    <td>${gradeData.assessment}</td>
                    <td>${gradeData.mark}/${gradeData.total}</td>
                    <td>${gradeData.percentage}%</td>
                    <td>${gradeData.grade}</td>
                    <td>${gradeData.date}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteGrade(${index})">Delete</button>
                    </td>
                `;
        });
      }

      function filterGrades() {
        const studentFilter =
          document.getElementById("gradeStudentFilter").value;
        const subjectFilter =
          document.getElementById("gradeSubjectFilter").value;
        const rows = document.querySelectorAll("#gradesTableBody tr");

        rows.forEach((row) => {
          const studentMatch =
            !studentFilter || row.cells[0].textContent.includes(studentFilter);
          const subjectMatch =
            !subjectFilter || row.cells[1].textContent.includes(subjectFilter);
          row.style.display = studentMatch && subjectMatch ? "" : "none";
        });
      }

      function deleteGrade(index) {
        if (confirm("Are you sure you want to delete this grade?")) {
          grades.splice(index, 1);
          saveData();
          renderGrades();
        }
      }

      // Fee management
      document
        .getElementById("feeForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const studentId = document.getElementById("feeStudent").value;
          const amount = parseFloat(document.getElementById("feeAmount").value);

          // Find existing fee record or create new one
          let feeRecord = fees.find((f) => f.student === studentId);
          if (!feeRecord) {
            feeRecord = {
              student: studentId,
              totalDue: 12000, // Annual school fees
              totalPaid: 0,
              payments: [],
            };
            fees.push(feeRecord);
          }

          const payment = {
            amount: amount,
            method: document.getElementById("feeMethod").value,
            date: document.getElementById("feeDate").value,
            reference: document.getElementById("feeReference").value,
            notes: document.getElementById("feeNotes").value,
          };

          feeRecord.payments.push(payment);
          feeRecord.totalPaid += amount;
          feeRecord.lastPayment = payment.date;

          saveData();
          renderFees();
          closeModal("feeModal");
          addActivity(
            `Payment recorded: R${amount} for ${
              students.find((s) => s.id === studentId)?.name
            }`
          );
        });

      function renderFees() {
        const tbody = document.getElementById("feesTableBody");
        tbody.innerHTML = "";

        let totalCollected = 0;
        let totalOutstanding = 0;

        // Ensure all students have fee records
        students.forEach((student) => {
          let feeRecord = fees.find((f) => f.student === student.id);
          if (!feeRecord) {
            feeRecord = {
              student: student.id,
              totalDue: 12000,
              totalPaid: 0,
              payments: [],
            };
            fees.push(feeRecord);
          }

          const outstanding = feeRecord.totalDue - feeRecord.totalPaid;
          const status =
            outstanding <= 0
              ? "Paid"
              : outstanding < feeRecord.totalDue
              ? "Partial"
              : "Outstanding";

          totalCollected += feeRecord.totalPaid;
          totalOutstanding += Math.max(0, outstanding);

          const row = tbody.insertRow();
          row.innerHTML = `
                    <td>${student.name}</td>
                    <td>R${feeRecord.totalDue.toFixed(2)}</td>
                    <td>R${feeRecord.totalPaid.toFixed(2)}</td>
                    <td>R${outstanding.toFixed(2)}</td>
                    <td><span class="status-${status.toLowerCase()}">${status}</span></td>
                    <td>${feeRecord.lastPayment || "No payments"}</td>
                    <td>
                        <button class="btn btn-primary" onclick="viewPayments('${
                          student.id
                        }')">View Payments</button>
                    </td>
                `;
        });

        document.getElementById(
          "totalFeesCollected"
        ).textContent = `R${totalCollected.toFixed(2)}`;
        document.getElementById(
          "totalFeesOutstanding"
        ).textContent = `R${totalOutstanding.toFixed(2)}`;
      }

      function viewPayments(studentId) {
        const feeRecord = fees.find((f) => f.student === studentId);
        const student = students.find((s) => s.id === studentId);

        if (feeRecord && feeRecord.payments.length > 0) {
          let paymentList = `Payment History for ${student.name}:\n\n`;
          feeRecord.payments.forEach((payment) => {
            paymentList += `Date: ${payment.date}\nAmount: R${payment.amount}\nMethod: ${payment.method}\n`;
            if (payment.reference)
              paymentList += `Reference: ${payment.reference}\n`;
            paymentList += "\n";
          });
          alert(paymentList);
        } else {
          alert(`No payments recorded for ${student.name}`);
        }
      }

      // Dashboard updates
      function updateDashboard() {
        document.getElementById("totalStudents").textContent = students.length;
        document.getElementById("totalTeachers").textContent = teachers.length;
        document.getElementById("totalClasses").textContent = classes.length;

        const totalFees = fees.reduce((sum, fee) => sum + fee.totalPaid, 0);
        document.getElementById(
          "totalFees"
        ).textContent = `R${totalFees.toFixed(2)}`;
      }

      function addActivity(activity) {
        const activitiesDiv = document.getElementById("recentActivities");
        const activityElement = document.createElement("p");
        activityElement.textContent = `${new Date().toLocaleString()}: ${activity}`;
        activitiesDiv.insertBefore(activityElement, activitiesDiv.firstChild);

        // Keep only last 10 activities
        const activities = activitiesDiv.querySelectorAll("p");
        if (activities.length > 10) {
          activitiesDiv.removeChild(activities[activities.length - 1]);
        }
      }

      // Populate dropdowns
      function populateDropdowns() {
        // Teacher dropdown for classes
        const classTeacherSelect = document.getElementById("classTeacher");
        classTeacherSelect.innerHTML =
          '<option value="">Select Teacher</option>';
        teachers.forEach((teacher) => {
          classTeacherSelect.innerHTML += `<option value="${teacher.id}">${teacher.name}</option>`;
        });

        // Student dropdown for grades
        const gradeStudentSelect = document.getElementById("gradeStudent");
        gradeStudentSelect.innerHTML =
          '<option value="">Select Student</option>';
        students.forEach((student) => {
          gradeStudentSelect.innerHTML += `<option value="${student.id}">${student.name}</option>`;
        });

        // Student dropdown for fees
        const feeStudentSelect = document.getElementById("feeStudent");
        feeStudentSelect.innerHTML = '<option value="">Select Student</option>';
        students.forEach((student) => {
          feeStudentSelect.innerHTML += `<option value="${student.id}">${student.name}</option>`;
        });

        // Filter dropdowns
        const gradeStudentFilter =
          document.getElementById("gradeStudentFilter");
        gradeStudentFilter.innerHTML = '<option value="">All Students</option>';
        students.forEach((student) => {
          gradeStudentFilter.innerHTML += `<option value="${student.name}">${student.name}</option>`;
        });

        const gradeSubjectFilter =
          document.getElementById("gradeSubjectFilter");
        const subjects = [...new Set(grades.map((g) => g.subject))];
        gradeSubjectFilter.innerHTML = '<option value="">All Subjects</option>';
        subjects.forEach((subject) => {
          gradeSubjectFilter.innerHTML += `<option value="${subject}">${subject}</option>`;
        });
      }

      // Reports
      function generateReport(type) {
        const reportContent = document.getElementById("reportContent");

        switch (type) {
          case "academic":
            generateAcademicReport(reportContent);
            break;
          case "financial":
            generateFinancialReport(reportContent);
            break;
          case "attendance":
            generateAttendanceReport(reportContent);
            break;
        }
      }

      function generateAcademicReport(container) {
        let report = "<h3>üìä Academic Performance Report</h3>";

        if (grades.length === 0) {
          report += "<p>No grade data available.</p>";
        } else {
          const gradeStats = {};
          grades.forEach((grade) => {
            if (!gradeStats[grade.grade]) gradeStats[grade.grade] = 0;
            gradeStats[grade.grade]++;
          });

          report += "<h4>Grade Distribution:</h4><ul>";
          Object.entries(gradeStats).forEach(([grade, count]) => {
            const percentage = ((count / grades.length) * 100).toFixed(1);
            report += `<li>Grade ${grade}: ${count} students (${percentage}%)</li>`;
          });
          report += "</ul>";

          const avgPercentage = (
            grades.reduce((sum, g) => sum + parseFloat(g.percentage), 0) /
            grades.length
          ).toFixed(1);
          report += `<p><strong>Overall Average: ${avgPercentage}%</strong></p>`;
        }

        container.innerHTML = report;
      }

      function generateFinancialReport(container) {
        let report = "<h3>üí∞ Financial Report</h3>";

        const totalDue = students.length * 12000;
        const totalPaid = fees.reduce((sum, fee) => sum + fee.totalPaid, 0);
        const outstanding = totalDue - totalPaid;
        const collectionRate = ((totalPaid / totalDue) * 100).toFixed(1);

        report += `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>R${totalDue.toFixed(2)}</h3>
                        <p>Total Fees Due</p>
                    </div>
                    <div class="stat-card">
                        <h3>R${totalPaid.toFixed(2)}</h3>
                        <p>Total Collected</p>
                    </div>
                    <div class="stat-card">
                        <h3>R${outstanding.toFixed(2)}</h3>
                        <p>Outstanding</p>
                    </div>
                    <div class="stat-card">
                        <h3>${collectionRate}%</h3>
                        <p>Collection Rate</p>
                    </div>
                </div>
            `;

        container.innerHTML = report;
      }

      function generateAttendanceReport(container) {
        let report = "<h3>üìÖ Attendance Report</h3>";
        report +=
          "<p>Attendance tracking feature coming soon. This will include:</p>";
        report += "<ul>";
        report += "<li>Daily attendance records</li>";
        report += "<li>Monthly attendance summaries</li>";
        report += "<li>Student attendance percentages</li>";
        report += "<li>Class-wise attendance reports</li>";
        report += "</ul>";

        container.innerHTML = report;
      }

      function exportData() {
        const data = {
          students,
          teachers,
          classes,
          grades,
          fees,
          exportDate: new Date().toISOString(),
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `school_data_${
          new Date().toISOString().split("T")[0]
        }.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        alert("Data exported successfully!");
      }

      // Initialize app
      window.addEventListener("load", function () {
        loadData();

        // Set default date for fee payments
        document.getElementById("feeDate").value = new Date()
          .toISOString()
          .split("T")[0];
        document.getElementById("gradeDate").value = new Date()
          .toISOString()
          .split("T")[0];
      });

      // Close modals when clicking outside
      window.addEventListener("click", function (event) {
        const modals = document.querySelectorAll(".modal");
        modals.forEach((modal) => {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });
      });
    </script>
  </body>
</html>
